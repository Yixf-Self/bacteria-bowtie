write.csv(sum_by_product_name,"sum_by_product_name.csv")
write.csv(filtered_annotated,"diff_exp_for_all_bact.csv")
View(sum_by_product_name)
library(reshape2)
library(tidyr)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/unknown-cuffnorm-out/")
setwd("/Users/Scott/unknown-cuffnorm-out/")
filtered_annotated <- read.csv("diff_exp_for_all_bact.csv")
filtered_annotated <- filtered_annotated[,2:9]
View(filtered_annotated)
filtered_annotated <- filtered_annotated[,2:8]
attach(filtered_annotated)
sum_by_product_name <- read.csv("sum_by_product_name.csv")
colnames(sum_by_product_name)[1]<-"product"
attach(sum_by_product_name)
View(sum_by_product_name)
sum_by_product_name<-sum_by_product_name[,1:5]
sum_by_product_name$product <- tolower(sum_by_product_name$product)
patric_annotation <- read.delim("../combined-cuffnorm-out/product_to_pathway.tab")
patric_annotation$product <- tolower(patric_annotation$product)
View(sum_by_product_name)
View(patric_annotation)
rm(annotation)
rm(filtered)
rm(filtered_annotated)
with_pathways<-merge(x=sum_by_product_name,y=patric_annotation,by.x="product",by.y="product")
View(with_pathways)
with_pathways_dups_removed<-with_pathways[!duplicated(with_pathways),]
with_pathways<-with_pathways_dups_removed
rm(with_pathways)
with_pathways<-merge(x=sum_by_product_name,y=patric_annotation,by.x="product",by.y="product")
with_pathways_dups_removed<-with_pathways[!duplicated(with_pathways),]
with_pathways<-with_pathways_dups_removed
rm(with_pathways_dups_removed)
View(with_pathways)
with_pathways<-with_pathways[grep(".+",with_pathways$pathway),]
with_pathways<-separate_rows(with_pathways, pathway, sep = ";")
sum_by_kegg_pathway<-rowsum(with_pathways[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group = with_pathways$pathway)
sum_by_kegg_pathway<-sum_by_kegg_pathway[!is.na(sum_by_kegg_pathway$S1_FPM),]
sum_by_kegg_pathway$sum<-rowSums(sum_by_kegg_pathway[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
sum_by_kegg_pathway$Name<-row.names(sum_by_kegg_pathway)
shortened<-sum_by_kegg_pathway[sum_by_kegg_pathway$sum>mean(sum_by_kegg_pathway$sum),]
shortened<-shortened[order(shortened$sum , decreasing = T),]
shortened<-shortened[,c("Name","S3_FPM","S4_FPM","S1_FPM","S2_FPM")]
colnames(shortened)=c("Name","S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (unknown)")
View(shortened)
setwd("~/bacteria-bowtie/scripts/R-interactive/")
write.table(shortened,"unknown_sum_by_kegg_pathway_above_mean.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway_above_mean.tab unknownBubble")
system("cp unknownBubble.pdf '/Users/Scott/Google Drive/Hurwitz Lab/manuscripts/'")
more_shortened$unknown_effect<-log(more_shortened$`S-H+ (unknown)`/more_shortened$`S+H- (Control)`)
more_shortened<-shortened[1:30,]
setwd("~/bacteria-bowtie/scripts/R-interactive/")
write.table(more_shortened,"unknown_sum_by_kegg_pathway_above_mean.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway_above_mean.tab unknownBubble")
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway.tab unknownBubble")
write.table(more_shortened,"unknown_sum_by_kegg_pathway.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway.tab unknownBubble")
system("cp unknownBubble.pdf '/Users/Scott/Google Drive/Hurwitz Lab/manuscripts/'")
more_shortened$unknown_effect<-log(more_shortened$`S-H+ (unknown)`/more_shortened$`S+H- (Control)`)
more_shortened$Hhep_effect<-log(more_shortened$`S+H+ (H. hepaticus only)`/more_shortened$`S+H- (Control)`)
more_shortened$smad_effect<-log(more_shortened$`S-H- (SMAD3 Knockout)`/more_shortened$`S+H- (Control)`)
more_shortened<-more_shortened[order(more_shortened$unknown_effect , decreasing = T),]
more_shortened$control_effect<-0
effects <- data.matrix(more_shortened[,6:9])
row.names(effects)<-more_shortened$Name
x=effects
oldPar <- par(no.readonly = T)
myColors=colorRampPalette(c("Blue","Yellow"))
heatmap(x, Rowv=NA, Colv=NA, col = myColors(255),scale="none", margins=c(5,5), cexCol=1, labCol = c("unknown", "H. hepaticus","SMAD3-KO","Nothing"))
new_bubble_source <- more_shortened[,1:5]
heatmap(x, Rowv=NA, Colv=NA, col = myColors(255),scale="none", margins=c(5,5), cexCol=1, labCol = c("combined", "H. hepaticus","SMAD3-KO","Nothing"))
new_bubble_source <- more_shortened[,1:5]
write.table(new_bubble_source,"sum_by_kegg_pathway_ordered_by_combined_effect.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh sum_by_kegg_pathway_ordered_by_combined_effect.tab unknownBubble_orderedbyeffect")
system("cp unknownBubble_orderedbyeffect.pdf '/Users/Scott/Google Drive/Hurwitz Lab/manuscripts/'")
View(more_shortened)
more_shortened<-shortened[1:30,]
more_shortened$combined_effect<-log(more_shortened$`S-H+ (unknown)`/more_shortened$`S+H- (Control)`)
more_shortened$Hhep_effect<-log(more_shortened$`S+H+ (H. hepaticus only)`/more_shortened$`S+H- (Control)`)
more_shortened$smad_effect<-log(more_shortened$`S-H- (SMAD3 Knockout)`/more_shortened$`S+H- (Control)`)
more_shortened<-more_shortened[order(more_shortened$combined_effect , decreasing = T),]
more_shortened$control_effect<-0
View(more_shortened)
library(xlsx)
write.xlsx(more_shortened,"sum_by_kegg_pathway_ordered_by_combined_effect.xlsx")
source('~/bacteria-bowtie/scripts/R-interactive/pathway_mapping_for_unknown.R', echo=TRUE)
library(reshape2)
library(tidyr)
library(xlsx)
setwd("/Users/Scott/unknown-cuffnorm-out/")
filtered_annotated <- read.csv("diff_exp_for_all_bact.csv")
filtered_annotated <- filtered_annotated[,2:8]
attach(filtered_annotated)
sum_by_product_name <- read.csv("sum_by_product_name.csv")
colnames(sum_by_product_name)[1]<-"product"
attach(sum_by_product_name)
sum_by_product_name<-sum_by_product_name[,1:5]
sum_by_product_name$product <- tolower(sum_by_product_name$product)
patric_annotation <- read.delim("../combined-cuffnorm-out/product_to_pathway.tab")
patric_annotation$product <- tolower(patric_annotation$product)
with_pathways<-merge(x=sum_by_product_name,y=patric_annotation,by.x="product",by.y="product")
with_pathways_dups_removed<-with_pathways[!duplicated(with_pathways),]
with_pathways<-with_pathways_dups_removed
rm(with_pathways_dups_removed)
with_pathways<-with_pathways[grep(".+",with_pathways$pathway),]
with_pathways<-separate_rows(with_pathways, pathway, sep = ";")
sum_by_kegg_pathway<-rowsum(with_pathways[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group = with_pathways$pathway)
sum_by_kegg_pathway<-sum_by_kegg_pathway[!is.na(sum_by_kegg_pathway$S1_FPM),]
sum_by_kegg_pathway$sum<-rowSums(sum_by_kegg_pathway[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
View(with_pathways)
sum_by_kegg_pathway<-sum_by_kegg_pathway[!is.na(sum_by_kegg_pathway$S1_FPM),]
sum_by_kegg_pathway$sum<-rowSums(sum_by_kegg_pathway[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
sum_by_kegg_pathway$Name<-row.names(sum_by_kegg_pathway)
shortened<-sum_by_kegg_pathway[sum_by_kegg_pathway$sum>mean(sum_by_kegg_pathway$sum),]
shortened<-shortened[order(shortened$sum , decreasing = T),]
shortened<-shortened[,c("Name","S3_FPM","S4_FPM","S1_FPM","S2_FPM")]
colnames(shortened)=c("Name","S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
more_shortened<-shortened[1:30,]
setwd("~/bacteria-bowtie/scripts/R-interactive/")
write.table(more_shortened,"unknown_sum_by_kegg_pathway.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway.tab unknownBubble")
system("cp unknownBubble.pdf '/Users/Scott/unknown-cuffnorm-out/'")
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway.tab unknownBubble")
system("cp unknownBubble.pdf '/Users/Scott/unknown-cuffnorm-out/'")
View(more_shortened)
write.table(more_shortened,"unknown_sum_by_kegg_pathway.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway.tab unknownBubble")
system("cp unknownBubble.pdf '/Users/Scott/unknown-cuffnorm-out/'")
View(more_shortened)
more_shortened_log<-more_shortened
more_shortened_log[,2:5]<-log(more_shortened[,2:5])
View(more_shortened_log)
more_shortened<-shortened[2:31,]
View(more_shortened)
rm(more_shortened_log)
setwd("~/bacteria-bowtie/scripts/R-interactive/")
write.table(more_shortened,"unknown_sum_by_kegg_pathway.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway.tab unknownBubble")
system("cp unknownBubble.pdf '/Users/Scott/unknown-cuffnorm-out/'")
system("source ~/.bash_profile && ./bubble.sh unknown_sum_by_kegg_pathway.tab unknownBubble_no_riboflavin")
system("cp unknownBubble_no_riboflavin.pdf '/Users/Scott/unknown-cuffnorm-out/'")
library(reshape2)
library(tidyr)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
filtered_annotated <- read.csv("diff_exp_for_all_bact.csv")
filtered_annotated <- filtered_annotated[,2:9]
sum_by_product_name <- read.csv("sum_by_product_name.csv")
colnames(sum_by_product_name)[1]<-"product"
sum_by_product_name<-sum_by_product_name[,1:5]
sum_by_product_name$product <- tolower(sum_by_product_name$product)
sum_by_gene_name <- read.csv("sum_by_gene_name.csv")
colnames(sum_by_gene_name)[1]<-"gene"
sum_by_gene_name<-sum_by_gene_name[,1:5]
sum_by_gene_name$gene <- tolower(sum_by_gene_name$gene)
patric_annotation <- read.delim("refseq_tag_to_pathway.tab")
with_pathways<-merge(x=filtered_annotated,y=patric_annotation[,c("refseq_locus_tag","pathway")],by.x="tracking_id",by.y="refseq_locus_tag")
with_pathways<-with_pathways[grep(".+",with_pathways$pathway),]
with_pathways<-separate_rows(with_pathways, pathway, sep = ";")
sum_by_kegg_pathway<-rowsum(with_pathways[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group = with_pathways$pathway)
sum_by_kegg_pathway<-sum_by_kegg_pathway[!is.na(sum_by_kegg_pathway$S1_FPM),]
sum_by_kegg_pathway$sum<-rowSums(sum_by_kegg_pathway[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
sum_by_kegg_pathway$Name<-row.names(sum_by_kegg_pathway)
shortened<-sum_by_kegg_pathway[sum_by_kegg_pathway$sum>mean(sum_by_kegg_pathway$sum),]
shortened<-shortened[order(shortened$sum , decreasing = T),]
shortened<-shortened[,c("Name","S3_FPM","S4_FPM","S1_FPM","S2_FPM")]
colnames(shortened)=c("Name","S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
setwd("~/tophat-bacteria/scripts/R-interactive/")
setwd("~/bacteria-bowtie/scripts/R-interactive/")
write.table(shortened,"sum_by_kegg_pathway_above_mean_for_known.tab", sep = "\t", quote = T,row.names = F)
source('~/bacteria-bowtie/scripts/R-interactive/pathway_mapping_forcuffnorm.R', echo=TRUE)
no_dups<-with_pathways[!duplicated(with_pathways),]
with_pathways<-no_dups
rm(no_dups)
sum_by_kegg_pathway<-rowsum(with_pathways[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group = with_pathways$pathway)
sum_by_kegg_pathway<-sum_by_kegg_pathway[!is.na(sum_by_kegg_pathway$S1_FPM),]
sum_by_kegg_pathway$sum<-rowSums(sum_by_kegg_pathway[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
sum_by_kegg_pathway$Name<-row.names(sum_by_kegg_pathway)
shortened<-sum_by_kegg_pathway[sum_by_kegg_pathway$sum>mean(sum_by_kegg_pathway$sum),]
shortened<-shortened[order(shortened$sum , decreasing = T),]
shortened<-shortened[,c("Name","S3_FPM","S4_FPM","S1_FPM","S2_FPM")]
colnames(shortened)=c("Name","S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
shortened$combined_effect<-log(shortened$`S-H+ (Combined)`/shortened$`S+H- (Control)`)
shortened$Hhep_effect<-log(shortened$`S+H+ (H. hepaticus only)`/shortened$`S+H- (Control)`)
shortened$smad_effect<-log(shortened$`S-H- (SMAD3 Knockout)`/shortened$`S+H- (Control)`)
shortened<-shortened[order(shortened$combined_effect , decreasing = T),]
shortened$control_effect<-0
effects <- data.matrix(shortened[,6:9])
row.names(effects)<-shortened$Name
x=effects
oldPar <- par(no.readonly = T)
myColors=colorRampPalette(c("Blue","Yellow"))
heatmap(x, Rowv=NA, Colv=NA, col = myColors(255),scale="none", margins=c(5,5), cexCol=1, labCol = c("Combined", "H. hepaticus","SMAD3-KO","Nothing"))
new_bubble_source <- shortened[,1:5]
setwd("~/bacteria-bowtie/scripts/R-interactive/")
write.table(new_bubble_source,"sum_by_kegg_pathway_ordered_by_combined_effect.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh sum_by_kegg_pathway_ordered_by_combined_effect.tab CombinedBubble_orderedbyeffect")
system("cp CombinedBubble_orderedbyeffect.pdf '/Users/Scott/Google Drive/Hurwitz Lab/manuscripts/'")
View(shortened)
max(effects)
min(effects)
source('~/bacteria-bowtie/scripts/R-interactive/pathway_mapping_forcuffnorm.R', echo=TRUE)
View(shortened)
attach(with_pathways)
colnames(with_pathways)
oxphos<-with_pathways[pathway="00190|Oxidative phosphorylation",]
oxphos<-with_pathways[pathway=="00190|Oxidative phosphorylation",]
View(oxphos)
no_blanks<-oxphos[oxphos$product_name!="",]
no_hypothetical<-no_blanks[grep("hypothetical",no_blanks$product_name,ignore.case = T),]
View(no_hypothetical)
no_hypothetical<-no_blanks[!grep("hypothetical",no_blanks$product_name,ignore.case = T),]
no_hypothetical<-no_blanks[grep("hypothetical",no_blanks$product_name,ignore.case = T,invert = T),]
oxphos<-no_hypothetical
rm(no_blanks,no_hypothetical)
View(oxphos)
oxphos_product_sums<-rowsum(oxphos,group=oxphos$product_name)
oxphos_product_sums<-rowsum(oxphos[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group=oxphos$product_name)
View(oxphos_product_sums)
colnames(with_pathways)
with_pathways<-merge(x=filtered_annotated,y=patric_annotation[,c("refseq_locus_tag","pathway")],by.x="tracking_id",by.y="refseq_locus_tag")
library(reshape2)
library(tidyr)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
filtered_annotated <- read.csv("diff_exp_for_all_bact.csv")
filtered_annotated <- filtered_annotated[,2:9]
sum_by_product_name <- read.csv("sum_by_product_name.csv")
colnames(sum_by_product_name)[1]<-"product"
sum_by_product_name<-sum_by_product_name[,1:5]
sum_by_product_name$product <- tolower(sum_by_product_name$product)
sum_by_gene_name <- read.csv("sum_by_gene_name.csv")
colnames(sum_by_gene_name)[1]<-"gene"
sum_by_gene_name<-sum_by_gene_name[,1:5]
sum_by_gene_name$gene <- tolower(sum_by_gene_name$gene)
patric_annotation <- read.delim("refseq_tag_to_pathway.tab")
with_pathways<-merge(x=filtered_annotated,y=patric_annotation[,c("refseq_locus_tag","pathway")],by.x="tracking_id",by.y="refseq_locus_tag")
with_pathways<-with_pathways[grep(".+",with_pathways$pathway),]
with_pathways<-separate_rows(with_pathways, pathway, sep = ";")
gsub('\"','',with_pathways$product_name)->with_pathways$product_name
gsub('%2c',',',with_pathways$product_name)->with_pathways$product_name
with_pathways<-with_pathways[grep(".*hypothetical protein.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*probable.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*predicted.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*uncharacterized.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*putative*",with_pathways$product_name,perl=T,invert=T),]
no_dups<-with_pathways[!duplicated(with_pathways),]
with_pathways<-no_dups
rm(no_dups)
sum_by_kegg_pathway<-rowsum(with_pathways[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group = with_pathways$pathway)
sum_by_kegg_pathway<-sum_by_kegg_pathway[!is.na(sum_by_kegg_pathway$S1_FPM),]
sum_by_kegg_pathway$sum<-rowSums(sum_by_kegg_pathway[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
sum_by_kegg_pathway$Name<-row.names(sum_by_kegg_pathway)
shortened<-sum_by_kegg_pathway[sum_by_kegg_pathway$sum>mean(sum_by_kegg_pathway$sum),]
shortened<-shortened[order(shortened$sum , decreasing = T),]
shortened<-shortened[,c("Name","S3_FPM","S4_FPM","S1_FPM","S2_FPM")]
colnames(shortened)=c("Name","S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
shortened$combined_effect<-log(shortened$`S-H+ (Combined)`/shortened$`S+H- (Control)`)
shortened$Hhep_effect<-log(shortened$`S+H+ (H. hepaticus only)`/shortened$`S+H- (Control)`)
shortened$smad_effect<-log(shortened$`S-H- (SMAD3 Knockout)`/shortened$`S+H- (Control)`)
shortened<-shortened[order(shortened$combined_effect , decreasing = T),]
shortened$control_effect<-0
effects <- data.matrix(shortened[,6:9])
row.names(effects)<-shortened$Name
x=effects
oldPar <- par(no.readonly = T)
myColors=colorRampPalette(c("Blue","Yellow"))
heatmap(x, Rowv=NA, Colv=NA, col = myColors(255),scale="none", margins=c(5,5), cexCol=1, labCol = c("Combined", "H. hepaticus","SMAD3-KO","Nothing"))
new_bubble_source <- shortened[,1:5]
setwd("~/bacteria-bowtie/scripts/R-interactive/")
View(shortened)
write.table(new_bubble_source,"sum_by_kegg_pathway_ordered_by_combined_effect.tab", sep = "\t", quote = T,row.names = F)
system("source ~/.bash_profile && ./bubble.sh sum_by_kegg_pathway_ordered_by_combined_effect.tab CombinedBubble_orderedbyeffect")
system("cp CombinedBubble_orderedbyeffect.pdf '/Users/Scott/Google Drive/Hurwitz Lab/manuscripts/'")
attach(with_pathways)
detach(with_pathways)
attach(with_pathways)
oxphos<-with_pathways[pathway=="00190|Oxidative phosphorylation",]
no_blanks<-oxphos[oxphos$product_name!="",]
no_hypothetical<-no_blanks[grep("hypothetical",no_blanks$product_name,ignore.case = T,invert = T),]
oxphos<-no_hypothetical
rm(no_blanks,no_hypothetical)
oxphos_product_sums<-rowsum(oxphos[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group=oxphos$product_name)
View(oxphos_product_sums)
oxphos_product_sums$sum<-sum(oxphos[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
oxphos_product_sums<-rowsum(oxphos[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group=oxphos$product_name)
no_zeros<-oxphos_product_sums[!(0 %in% oxphos[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")]),]
View(oxphos)
View(no_zeros)
oxphos_product_sums[oxphos_product_sums==0,]<-NA
which(oxphos_product_sums==0)
no_zeros<-apply(oxphos_product_sums,1,function(row) all(row != 0))
truthy<-apply(oxphos_product_sums,1,function(row) all(row != 0))
no_zeros<-oxphos_product_sums[truthy,]
View(no_zeros)
oxphos_product_sums<-no_zeros
rm(truthy,no_zeros)
rm(truthy,no_zeros,x)
View(oxphos_product_sums)
colnames(oxphos_product_sums)=c("S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
View(oxphos_product_sums)
oxphos_product_sums$combined_effect<-log(oxphos_product_sums$`S-H+ (Combined)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$Hhep_effect<-log(oxphos_product_sums$`S+H+ (H. hepaticus only)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$smad_effect<-log(oxphos_product_sums$`S-H- (SMAD3 Knockout)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums<-oxphos_product_sums[order(oxphos_product_sums$combined_effect , decreasing = T),]
write.table(with_pathways,"with_pathways.tab",row.names = F)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
write.table(with_pathways,"with_pathways.tab",row.names = F)
View(with_pathways)
with_pathways2<-read.table("with_pathways.tab")
with_pathways2<-read.table("with_pathways.tab",header=T)
with_pathways==with_pathways2
colnames(with_pathways)
colnames(with_pathways2)
View(with_pathways)
View(with_pathways2)
source('~/bacteria-bowtie/scripts/R-interactive/pathway_mapping_forcuffnorm.R', echo=TRUE)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
library(reshape2)
library(tidyr)
library(RColorBrewer)
#setup####
with_pathways2<-read.table("with_pathways.tab",header=T)
View(with_pathways2)
View(with_pathways)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
library(reshape2)
library(tidyr)
library(RColorBrewer)
with_pathways<-read.table("with_pathways.tab",header=T)
attach(with_pathways)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
library(reshape2)
library(tidyr)
library(RColorBrewer)
with_pathways<-read.table("with_pathways.tab",header=T)
attach(with_pathways)
oxphos<-with_pathways[pathway=="00190|Oxidative phosphorylation",]
no_blanks<-oxphos[oxphos$product_name!="",]
no_hypothetical<-no_blanks[grep("hypothetical",no_blanks$product_name,ignore.case = T,invert = T),]
oxphos<-with_pathways[pathway=="00190|Oxidative phosphorylation",]
no_blanks<-oxphos[oxphos$product_name!="",]
oxphos<-no_blanks
rm(no_blanks)
oxphos_product_sums<-rowsum(oxphos[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group=oxphos$product_name)
truthy<-apply(oxphos_product_sums,1,function(row) all(row != 0))
no_zeros<-oxphos_product_sums[truthy,]
oxphos_product_sums<-no_zeros
rm(truthy,no_zeros,x)
colnames(oxphos_product_sums)=c("S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
oxphos_product_sums$combined_effect<-log(oxphos_product_sums$`S-H+ (Combined)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$Hhep_effect<-log(oxphos_product_sums$`S+H+ (H. hepaticus only)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$smad_effect<-log(oxphos_product_sums$`S-H- (SMAD3 Knockout)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums<-oxphos_product_sums[order(oxphos_product_sums$combined_effect , decreasing = T),]
View(oxphos_product_sums)
rm(no_hypothetical)
View(oxphos_product_sums)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
library(reshape2)
library(tidyr)
library(RColorBrewer)
with_pathways<-read.table("with_pathways.tab",header=T)
attach(with_pathways)
oxphos<-with_pathways[pathway=="00190|Oxidative phosphorylation",]
no_blanks<-oxphos[oxphos$product_name!="",]
oxphos<-no_blanks
rm(no_blanks)
library(reshape2)
library(tidyr)
library(RColorBrewer)
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
filtered_annotated <- read.csv("diff_exp_for_all_bact.csv")
filtered_annotated <- filtered_annotated[,2:9]
sum_by_product_name <- read.csv("sum_by_product_name.csv")
colnames(sum_by_product_name)[1]<-"product"
sum_by_product_name<-sum_by_product_name[,1:5]
sum_by_product_name$product <- tolower(sum_by_product_name$product)
sum_by_gene_name <- read.csv("sum_by_gene_name.csv")
colnames(sum_by_gene_name)[1]<-"gene"
sum_by_gene_name<-sum_by_gene_name[,1:5]
sum_by_gene_name$gene <- tolower(sum_by_gene_name$gene)
patric_annotation <- read.delim("refseq_tag_to_pathway.tab")
with_pathways<-merge(x=filtered_annotated,y=patric_annotation[,c("refseq_locus_tag","pathway")],by.x="tracking_id",by.y="refseq_locus_tag")
with_pathways<-with_pathways[grep(".+",with_pathways$pathway),]
with_pathways<-separate_rows(with_pathways, pathway, sep = ";")
gsub('\"','',with_pathways$product_name)->with_pathways$product_name
gsub('%2c',',',with_pathways$product_name)->with_pathways$product_name
with_pathways<-with_pathways[grep(".*hypothetical protein.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*probable.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*predicted.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*uncharacterized.*",with_pathways$product_name,perl=T,invert=T),]
with_pathways<-with_pathways[grep(".*putative*",with_pathways$product_name,perl=T,invert=T),]
no_dups<-with_pathways[!duplicated(with_pathways),]
with_pathways<-no_dups
rm(no_dups)
sum_by_kegg_pathway<-rowsum(with_pathways[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group = with_pathways$pathway)
sum_by_kegg_pathway<-sum_by_kegg_pathway[!is.na(sum_by_kegg_pathway$S1_FPM),]
sum_by_kegg_pathway$sum<-rowSums(sum_by_kegg_pathway[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")])
sum_by_kegg_pathway$Name<-row.names(sum_by_kegg_pathway)
shortened<-sum_by_kegg_pathway[sum_by_kegg_pathway$sum>mean(sum_by_kegg_pathway$sum),]
shortened<-shortened[order(shortened$sum , decreasing = T),]
shortened<-shortened[,c("Name","S3_FPM","S4_FPM","S1_FPM","S2_FPM")]
colnames(shortened)=c("Name","S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
shortened$combined_effect<-log(shortened$`S-H+ (Combined)`/shortened$`S+H- (Control)`)
shortened$Hhep_effect<-log(shortened$`S+H+ (H. hepaticus only)`/shortened$`S+H- (Control)`)
shortened$smad_effect<-log(shortened$`S-H- (SMAD3 Knockout)`/shortened$`S+H- (Control)`)
shortened<-shortened[order(shortened$combined_effect , decreasing = T),]
shortened$control_effect<-0
effects <- data.matrix(shortened[,6:9])
row.names(effects)<-shortened$Name
x=effects
oldPar <- par(no.readonly = T)
myColors=colorRampPalette(c("Blue","Yellow"))
heatmap(x, Rowv=NA, Colv=NA, col = myColors(255),scale="none", margins=c(5,5), cexCol=1, labCol = c("Combined", "H. hepaticus","SMAD3-KO","Nothing"))
new_bubble_source <- shortened[,1:5]
View(new_bubble_source)
max(new_bubble_source)
max(new_bubble_source[,1:4])
max(new_bubble_source[,2:5])
View(shortened)
max(shortened[,6:9])
min(shortened[,6:9])
setwd("/Users/Scott/Google Drive/Hurwitz Lab/cuffnorm-out")
library(reshape2)
library(tidyr)
library(RColorBrewer)
#setup####
with_pathways<-read.table("with_pathways.tab",header=T)
#oxidative phosphorylation####
attach(with_pathways)
detach(with_pathways)
attach(with_pathways)
oxphos<-with_pathways[pathway=="00190|Oxidative phosphorylation",]
no_blanks<-oxphos[oxphos$product_name!="",]
oxphos<-no_blanks
rm(no_blanks)
oxphos_product_sums<-rowsum(oxphos[,c("S1_FPM","S2_FPM","S3_FPM","S4_FPM")],group=oxphos$product_name)
truthy<-apply(oxphos_product_sums,1,function(row) all(row != 0))
no_zeros<-oxphos_product_sums[truthy,]
oxphos_product_sums<-no_zeros
rm(truthy,no_zeros)
colnames(oxphos_product_sums)=c("S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
oxphos_product_sums$combined_effect<-log(oxphos_product_sums$`S-H+ (Combined)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$Hhep_effect<-log(oxphos_product_sums$`S+H+ (H. hepaticus only)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$smad_effect<-log(oxphos_product_sums$`S-H- (SMAD3 Knockout)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums<-oxphos_product_sums[order(oxphos_product_sums$combined_effect , decreasing = T),]
View(oxphos_product_sums)
atpb<-with_pathways[product_name="atpb",]
atpb<-with_pathways[product_name=="atpb",]
View(atpb)
library(RColorBrewer)
library(reshape2)
library(ggplot2)
library(dplyr)
library(ggiraph)
genome_to_feature <- read.delim("genome-name_to_refseq-locus-tag")
system("cut -f2,7 all.PATRIC.cds.tab > genome-name_to_refseq-locus-tag")
genome_to_feature <- read.delim("genome-name_to_refseq-locus-tag")
thing1<-merge(atpb,genome_to_feature,all.y=F)
View(atpb)
View(genome_to_feature)
atpb<-with_pathways[product_name=="atpb" && pathway=="00190|Oxidative phosphorylation",]
important <- merge(x=atpb,y=genome_to_feature,by.x="tracking_id",by.y="refseq_locus_tag",all = F)
atpb<-with_pathways[product_name=="atpb" && pathway=="00190|Oxidative phosphorylation",]
atpb<-with_pathways[product_name=="atpb",]
View(atpb)
atpb<-with_pathways[product_name=="atpb"&&pathway=="00190|Oxidative phosphorylation",]
atpb<-with_pathways[product_name=="atpb" & pathway=="00190|Oxidative phosphorylation",]
View(atpb)
important <- merge(x=atpb,y=genome_to_feature,by.x="tracking_id",by.y="refseq_locus_tag",all = F)
View(important)
View(oxphos_product_sums)
atpa<-with_pathways[product_name=="f0f1 atp synthase subunit alpha" & pathway=="00190|Oxidative phosphorylation",]
important <- merge(x=atpa,y=genome_to_feature,by.x="tracking_id",by.y="refseq_locus_tag",all = F)
View(important)
atpb<-with_pathways[product_name=="atpb" & pathway=="00190|Oxidative phosphorylation",]
important <- merge(x=atpb,y=genome_to_feature,by.x="tracking_id",by.y="refseq_locus_tag",all = F)
#and for the lowest f0f1 atp synthase subunit alpha
atpa<-with_pathways[product_name=="f0f1 atp synthase subunit alpha" & pathway=="00190|Oxidative phosphorylation",]
important2 <- merge(x=atpa,y=genome_to_feature,by.x="tracking_id",by.y="refseq_locus_tag",all = F)
View(important)
View(important2)
View(oxphos_product_sums)
View(important2)
sum(important2$S2_FPM)
sum(important2$S2_FPM)/sum(important2$S3_FPM)
View(atpa)
oxphos_product_sums<-rowsum(oxphos[,c("S3_FPM","S4_FPM","S1_FPM","S2_FPM")],group=oxphos$product_name)
truthy<-apply(oxphos_product_sums,1,function(row) all(row != 0))
no_zeros<-oxphos_product_sums[truthy,]
oxphos_product_sums<-no_zeros
rm(truthy,no_zeros)
colnames(oxphos_product_sums)=c("S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
oxphos_product_sums$combined_effect<-log(oxphos_product_sums$`S-H+ (Combined)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$Hhep_effect<-log(oxphos_product_sums$`S+H+ (H. hepaticus only)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums$smad_effect<-log(oxphos_product_sums$`S-H- (SMAD3 Knockout)`/oxphos_product_sums$`S+H- (Control)`)
oxphos_product_sums<-oxphos_product_sums[order(oxphos_product_sums$combined_effect , decreasing = T),]
View(oxphos_product_sums)
oxphos_product_sums$`S-H+ (Combined)`[3]
oxphos_product_sums$`S-H+ (Combined)`[3]/oxphos_product_sums$`S+H- (Control)`[3]
atpb<-with_pathways[product_name=="atpb" & pathway=="00190|Oxidative phosphorylation",]
atpb<-with_pathways[product_name=="atp synthase beta chain" & pathway=="00190|Oxidative phosphorylation",]
important <- merge(x=atpb,y=genome_to_feature,by.x="tracking_id",by.y="refseq_locus_tag",all = F)
View(important)
atpa<-with_pathways[product_name=="atp synthase alpha chain" & pathway=="00190|Oxidative phosphorylation",]
important2 <- merge(x=atpa,y=genome_to_feature,by.x="tracking_id",by.y="refseq_locus_tag",all = F)
View(important2)
library(xlsx)
colnames(important2[,2:5])<-c("S+H- (Control)","S-H- (SMAD3 Knockout)","S+H+ (H. hepaticus only)","S-H+ (Combined)")
View(important2)
write.xlsx(oxphos_product_sums,"oxphos_product_sums.xlsx")
write.xlsx(important,"atp synthase beta chain downregulated.xlsx")
write.xlsx(important2,"atp synthatse alpha chain upregualted.xlsx")
